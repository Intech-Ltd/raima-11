<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:tocPath="SQL API|RSQL User's Guide|RSQL API Function Reference" MadCap:InPreviewMode="false" MadCap:PreloadImages="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" lang="en-us" xml:lang="en-us" MadCap:PathToHelpSystem="../../" MadCap:HelpSystemFileName="Default.xml" MadCap:SearchType="Stem">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>rsqlRegisterUDFs</title>
        <link rel="icon" type="image/png" href="http://docs.raima.com/favicon.png" />
        <link href="../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../Resources/TableStyles/FunctionArgs.css" rel="stylesheet" />
        <link href="../Resources/TableStyles/SQLErrorCodes.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/raima.css" rel="stylesheet" />
        <script src="../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop" style="display: none;"><a href="../../Default_CSH.htm#SQLRM/rsqlRegisterUDFs.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../dbRSQL.htm">SQL API</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../RSQLUG/dbSQLUG.htm">RSQL User's Guide</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="SQLAPIReference.htm">RSQL API Function Reference</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">rsqlRegisterUDFs</span>
        </div>
        <h3 class="newpage"><a name="kanchor314"></a>rsqlRegisterUDFs</h3>
        <p>Register C-based user-defined functions</p>
        <p class="Heading">Prototype</p><pre xml:space="preserve">RSQL_ERRCODE EXTERNAL_FCN rsqlRegisterUDFs(
    HCONN               hConn,   
    uint16_t            noUdfs,
    const UDFLOADTABLE *udftab,  
    void               *pRegCtx, 
    const size_t        szFcnCtx)</pre>
        <p class="Heading">Arguments</p>
        <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/FunctionArgs.css');caption-side: top;margin-left: 0;margin-right: auto;" class="TableStyle-FunctionArgs" cellspacing="0">
            <col class="Column-Column1" />
            <col class="Column-Column3" />
            <col class="Column-Column2" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">hConn</td>
                    <td class="BodyE-Column3-Body1">(input)</td>
                    <td class="BodyD-Column2-Body1">Connection handle.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">noUdfs</td>
                    <td class="BodyE-Column3-Body1">(input)</td>
                    <td class="BodyD-Column2-Body1">Number of user-defined functions specified in <code>udftab</code>.</td>
                </tr>
                <tr class="Body-Body1">
                    <td class="BodyE-Column1-Body1">udftab</td>
                    <td class="BodyE-Column3-Body1">(input)</td>
                    <td class="BodyD-Column2-Body1">Pointer to the user-defined function load table.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">pRegCtx</td>
                    <td class="BodyE-Column3-Body1">(input)</td>
                    <td class="BodyD-Column2-Body1">A pointer to application-specific registration context data area.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyB-Column1-Body1">szFetchCtx</td>
                    <td class="BodyB-Column3-Body1">(input)</td>
                    <td class="BodyA-Column2-Body1">Size of the application-specific fetch context.</td>
                </tr>
            </tbody>
        </table>
        <p class="Heading">Description</p>
        <p>Function <code>rsqlRegisterUDFs</code> needs to be called in order to make the function entry points associated with a set of user-defined functions available to the <span class="MyVariablesRSQLName">RDM SQL</span> engine on the connection specified by <code>hConn</code>.  The <code>UDFLOADTABLE</code> is declared in header file <code>rsqltypes.h</code> (which is <code>#include</code>'d by <code>rsql.h</code>).   This function must be called prior to calling <code>rsqlPrepare</code> which compiles a statement that calls any of the user-defined functions specified in <code>udftab</code>.</p>
        <p>Five arguments are passed into function <code>rsqlRegisterUDFs</code>: the connection handle, the number of entries in the UDF load table, the address of the UDF load table, a pointer to a user registration context data area (which can be <code>NULL</code> if unnecessary), and the maximum size that is needed for a UDF execution context (e.g., aggregate functions in particular will use this space to keep track of computationally important data from each detail row of the set of rows comprising each aggregate).</p>
        <p>The <code>pRegCtx</code> can be used by the application program to pass in any application-specific, execution-independent data that will be needed by one or more UDFs.  If no registration context is needed the <code>pRegCtx</code> argument should be <code>NULL</code>. The specified <code>pRefCtx</code> pointer is passed to the <code>udfCheck</code> and <code>udfInit</code> functions.</p>
        <p>The <code>szFcnCtx</code> needs to be set to the largest context data area used for all of the UDFs. This space will be automatically allocated by the <span class="MyVariablesRSQLName">RDM SQL</span> engine and passed to the execution-time UDF functions (all but <code>udfCheck</code>).  If no function context is needed then <code>szFcnCtx</code> should be 0.</p>
        <p>Only one <code>udftab</code> can be registered in a connection.   Any additional attempts to call <code>rsqlRegisterUDFs</code> after the first will return error code <code>errREGISTERED</code>.</p>
        <p class="Heading">Example</p><pre xml:space="preserve">/* application program */
#include "rsql.h"

<b>extern const UDFLOADTABLE UdfTable[];
extern const size_t szUdfCtx;</b>
MyApplication() 
{
	HCONN hdbc;

	if ( rsqlAllocConn(&amp;hdbc) == errSUCCESS ) {
		<b>rsqlRegisterUDFs(hdbc, 2, UdfTable, NULL, szUdfCtx);</b>
 	...
}
</pre><pre xml:space="preserve">/* UDF module */
#include "rsql.h"
	. . .
/* Soundex UDF data context packet */
typedef struct sndx_ctx {
    char       sndx[5];    /* code buffer needs to survive each soundex() call */
} SNDX_CTX;

/* Matchcount UDF data context packet */
typedef struct count_cxt {
    RSQL_ERRCODE stat;     /* CntCall error status */
    int64_t      count;    /* Current match count  */
} COUNT_CTX;

const size_t szUdfCtx = RDM_MAX(sizeof(SNDX_CTX), sizeof(COUNT_CTX));

/* UDF functions for soundex */
static UDFCHECK      SndxCheck;
static UDFSCALARCALL SndxCall;

/* user function for matchcount */
static UDFCHECK      CntCheck;
static UDFAGGCALL    CntCall;
static UDFAGGRESULT  CntResult;
static UDFAGGRESET   CntReset;

/* table of user functions callable from within an sql expression */
const UDFLOADTABLE UdfTable[] = {
    /*                                        Scalar   Aggregate--------------- */
    /* Name       Type    Check     Init Term Call     Call    Result    Reset  */
    /* --------   ------- --------- ---- ---- -------- ------- --------- ------ */
    {"soundex",   tCHAR,  SndxCheck,NULL,NULL,SndxCall,NULL,   NULL,     NULL},
    {"matchcount",tBIGINT,CntCheck, NULL,NULL,NULL,    CntCall,CntResult,CntReset}
};
</pre>
        <p class="Heading">RSQL&#160;User Guide</p>
        <p><a href="../SQL/Chapter12.htm#UDF">UDF Load Table Definition and Registration</a>
        </p>
        <p class="Heading">Required Headers</p><pre xml:space="preserve">#include "rsql.h"</pre>
        <p class="Heading">Libraries</p>
        <table style="width: 100%; margin-left: 0; margin-right: auto;">
            <col style="width: 200px;">
            </col>
            <col>
            </col>
            <thead>
                <tr>
                    <th>Library Name</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>rdmrsql<span class="MyVariablesLibraryVersion">11</span></code>
                    </td>
                    <td>RSQL&#160;API Library</td>
                </tr>
            </tbody>
        </table>
        <p>See <a href="../GS/distrib.htm#Library">Library Naming Conventions</a> section for full library name and a list of library dependencies.</p>
        <p class="Heading">Return Codes</p>
        <table class="TableStyle-SQLErrorCodes" cellspacing="0" style="mc-table-style: url('../Resources/TableStyles/SQLErrorCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <col class="Column-Column4" />
            <tbody>
                <tr class="Body-Body1">
                    <th class="BodyB-Column1-Body1" style="font-weight: bold;">Error Code</th>
                    <th class="BodyB-Column2-Body1" style="font-weight: bold;">Enum Identifier</th>
                    <th class="BodyB-Column3-Body1" style="font-weight: bold;">SQL State</th>
                    <th class="BodyA-Column4-Body1" style="font-weight: bold;">Description</th>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-SQLErrorCodes" cellspacing="0" style="mc-table-style: url('../Resources/TableStyles/SQLErrorCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <col class="Column-Column4" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">0</td>
                    <td class="BodyB-Column2-Body1">errSUCCESS</td>
                    <td class="BodyB-Column3-Body1">00000</td>
                    <td class="BodyA-Column4-Body1">no error was detected</td>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-SQLErrorCodes" cellspacing="0" style="mc-table-style: url('../Resources/TableStyles/SQLErrorCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <col class="Column-Column4" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">-5</td>
                    <td class="BodyB-Column2-Body1">errINVHANDLE</td>
                    <td class="BodyB-Column3-Body1">02002</td>
                    <td class="BodyA-Column4-Body1">invalid connection or statement handle</td>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-SQLErrorCodes" cellspacing="0" style="mc-table-style: url('../Resources/TableStyles/SQLErrorCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <col class="Column-Column4" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">78</td>
                    <td class="BodyB-Column2-Body1">errREGISTERED</td>
                    <td class="BodyB-Column3-Body1">42000</td>
                    <td class="BodyA-Column4-Body1">UDF/UDP/XTF already registered</td>
                </tr>
            </tbody>
        </table>
        <p class="Heading">See Also</p>
        <p><a href="rsqlRegisterVirtualTables.htm">rsqlRegisterVirtualTables</a>
        </p>
        <hr MadCap:conditions="Default.ScreenOnly" width="100%" size="0" align="center" />
        <p MadCap:conditions="Default.ScreenOnly" style="font-size: 8pt;"><span class="MyVariablesCopyright">Copyright © 2012, Raima Inc. All rights reserved.</span>
        </p>
        <script type="text/javascript" src="../SkinSupport/MadCapBodyEnd.js">
        </script>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom" style="display: none;"><a href="../../Default_CSH.htm#SQLRM/rsqlRegisterUDFs.htm" style="">Open topic with navigation</a>
        </p>
    </body>
</html>