<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:tocPath="Replication and Mirroring Guide|User's Guide" MadCap:InPreviewMode="false" MadCap:PreloadImages="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" lang="en-us" xml:lang="en-us" class="" MadCap:PathToHelpSystem="../../" MadCap:HelpSystemFileName="Default.xml" MadCap:SearchType="Stem">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Mirroring Setup</title>
        <link rel="icon" type="image/png" href="http://docs.raima.com/favicon.png" />
        <link href="../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/raima.css" rel="stylesheet" />
        <script src="../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop" style="display: none;"><a href="../../Default_CSH.htm#DFUG/Chapter5.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../dbDataFlow.htm">Replication and Mirroring Guide</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbsSelf">User's Guide</span><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Mirroring Setup</span>
        </div>
        <h1>Mirroring Setup</h1>
        <p>Mirroring is enabled by an INI&#160;file setting. In the '[configuration]' section, the key 'mirroring' is set to 1 to enable or 0 to disable mirroring.</p>
        <p>The <code>ini</code> files may be at the server or database level. At the server level, the document root may contain a file named <code><a name="kanchor429"></a>tfs.ini</code> that may contain any of the below-defined parameters. If specified, the parameter values are the default values for all databases within the scope of this TFS. The default values may be overridden by placing <code><i>dbname</i>.ini</code> into the database's subdirectory under the document root.</p><pre xml:space="preserve">[configuration]
; mirroring is set to 1 (TRUE) to indicate that a database will be
; mirrored. This option is not required for and does not affect replication.<br />; When set to 1, change log files will not be immediately deleted.<br />; Default is 0.
mirroring=1</pre>
        <p>By default, the <code>tfserver</code> utility will delete change log files after they have been checkpointed to the database. To mirror a database, these log files must be retained. Log retention is controlled through two <code>ini</code> file parameters, as follows:</p><pre xml:space="preserve">[LogCleanup]<br />; LogFileAge gives amount of time to retain log files before removing them.<br />; Use Ns for N seconds, m for minutes, h for hours, or d for days.
; Default is 10m.  Set to 0 to never remove logs.<br />LogFileAge=10m
; LogFileSpace gives disk space used by log files before removing them.
; Use Nk for N kilobytes, m for megabytes, or g for gigabytes.
; There is no default space limit.  Also, set to 0 for no space limit.<br />LogFileSpace=100m<br /></pre>
        <p>When log files are removed, the oldest are always removed first. This may trigger a full-database refresh if a mirroring or replicating client makes a request for a <i>next</i> log that has been deleted.</p>
        <p class="Heading">Default Options with Masters and Slaves on Different Computers</p>
        <p>When only one TFS is run on each computer, the default ports should be used, and may be left off the command-line. The default port for <code>tfserver</code> is <code><span class="MyVariablesDefaultPort">21553</span></code>. The <code>dbget</code> utility refers to anchor port <code><span class="MyVariablesDefaultPort">21553</span></code> to connect to <code>dbmirror</code>. The following example assumes that two Windows and two Linux machines are being used.</p>
        <p>Master 1 (Windows, <code>tfs.raima.com</code>), controlling <code>sales</code> and <code>mkt</code> databases:</p><pre xml:space="preserve">
c:
cd \RDM\databases.win32
start tfserver
start dbmirror</pre>
        <p>Master 2 (Linux, <code>RLM-lptp</code>), controlling <code>tims</code> database:</p><pre xml:space="preserve">
cd /RDM/databases.lnx
tfserver &amp;
dbmirror &amp;</pre>
        <p>Slave 1 (Windows, <code>WLW-XP</code>):</p><pre xml:space="preserve">d:
cd \databases.win32
start tfserver
start dbmirror
dbget -b mkt@tfs.raima.com
dbget -b sales@tfs.raima.com</pre>
        <p>Slave 2 (Linux, <code>dai-desktop</code>):</p><pre xml:space="preserve">tfserver -d /home/databases &amp;
dbmirror -d /home/databases &amp;
dbget -b mkt@tfs.raima.com
dbget -b tims@RLM-lptp</pre>
        <p class="Heading">Using dbget From a Different Computer</p>
        <p>The <code>dbget</code> utility will commonly be used from within the context of the slave database, but it doesn't need to be. It simply needs to address the correct <code>dbmirror</code> slave process. Assuming that the master and slave processes have been set up as above, then the following <code>dbget</code> invocations will achieve the same results and will work from any of the computers:</p><pre xml:space="preserve">dbget -b -s WLW-XP mkt@tfs.raima.com
dbget -b -s WLW-XP sales@tfs.raima.com
dbget -b -s dai-desktop mkt@tfs.raima.com
dbget -b -s dai-desktop tims@RLM-lptp</pre>
        <p class="Heading">Non-Default Options with Masters and Slaves on the Same Computer</p>
        <p>This example shows the opposite extreme from the first example, where all masters and slaves are now to operate on the same computer. We will not use default ports for anything, although they will all use <code>localhost</code> as the domain. All <code>tfserver</code> and <code>dbmirror</code> processes must use different ports, and the <code>dbget</code> utility must refer to the correct ports. The following table shows how this will be configured:</p>
        <table style="width: 100%;caption-side: bottom;border-left-style: solid;border-left-width: 0px;border-left-color: #c0c0c0;border-right-style: solid;border-right-width: 0px;border-right-color: #c0c0c0;border-top-style: solid;border-top-width: 0px;border-top-color: #c0c0c0;border-bottom-style: solid;border-bottom-width: 0px;border-bottom-color: #c0c0c0;margin-left: 0;margin-right: auto;" class="TableStyle_maintbl">
            <caption>Table 12-1 Same-computer Mirroring Configuration</caption>
            <col style="width: 114px;" />
            <col style="width: 101px;" />
            <col style="width: 275px;" />
            <col style="width: 228px;" />
            <thead>
                <tr>
                    <th>Role</th>
                    <th>Utility</th>
                    <th>Document Root</th>
                    <th>Port</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Master 1</td>
                    <td>tfserver</td>
                    <td>
                        <p>c:\RDM\databases.win32</p>
                    </td>
                    <td>1730</td>
                </tr>
                <tr>
                    <td>Master 1</td>
                    <td>dbmirror</td>
                    <td>c:\RDM\databases.win32</td>
                    <td>1730</td>
                </tr>
                <tr>
                    <td>Master 2</td>
                    <td>tfserver</td>
                    <td>c:\databases</td>
                    <td>1830</td>
                </tr>
                <tr>
                    <td>Master 2</td>
                    <td>dbmirror</td>
                    <td>c:\databases</td>
                    <td>1830</td>
                </tr>
                <tr>
                    <td>Slave 1</td>
                    <td>tfserver</td>
                    <td>d:\databases.win32</td>
                    <td>1840</td>
                </tr>
                <tr>
                    <td>Slave 1</td>
                    <td>dbmirror</td>
                    <td>d:\databases.win32</td>
                    <td>1840</td>
                </tr>
                <tr>
                    <td>Slave 2</td>
                    <td>tfserver</td>
                    <td>d:\home\databases</td>
                    <td>1940</td>
                </tr>
                <tr>
                    <td>Slave 2</td>
                    <td>dbmirror</td>
                    <td>d:\home\databases</td>
                    <td>1940</td>
                </tr>
            </tbody>
        </table>
        <p>Master 1, controlling <code>sales</code> and <code>mkt</code> databases:</p><pre xml:space="preserve">
c:
cd \RDM\databases.win32
start tfserver -p 1730
start dbmirror -p 1730</pre>
        <p>Master 2, controlling <code>tims</code> database:</p><pre xml:space="preserve">
c:
cd \databases
start tfserver -p 1830
start dbmirror -p 1830</pre>
        <p>Slave 1:</p><pre xml:space="preserve">d:
cd \databases.win32
start tfserver -p 1840
start dbmirror -p 1840
dbget -b -p 1840 mkt@localhost:1730
dbget -b -p 1840 sales@localhost:1730</pre>
        <p>Slave 2:</p><pre xml:space="preserve">start tfserver -p 1940 -d d:\home\databases
start dbmirror -p 1940 -d d:\home\databases
dbget -b -p 1940 mkt@localhost:1730
dbget -b -p 1940 tims@localhost:1830</pre>
        <p class="Heading">Using dbget From a Different Computer, Again</p>
        <p>This example corresponds to the example above, where all of the utilities are being run on the same computer (say, <code>tfs.raima.com</code>). The <code>dbget</code> utility can be run from anywhere, and in this case, it must specify the correct ports (for the <code>dbmirror</code> process and master database) as well as the domain:</p><pre xml:space="preserve">dbget -b -s tfs.raima.com -p 1840 mkt@tfs.raima.com:1730
dbget -b -s tfs.raima.com -p 1840 sales@tfs.raima.com:1730
dbget -b -s tfs.raima.com -p 1940 mkt@tfs.raima.com:1730
dbget -b -s tfs.raima.com -p 1940 tims@tfs.raima.com:1830</pre>
        <hr MadCap:conditions="Default.ScreenOnly" width="100%" size="0" align="center" />
        <p MadCap:conditions="Default.ScreenOnly" style="font-size: 8pt;"><span class="MyVariablesCopyright">Copyright © 2012, Raima Inc. All rights reserved.</span>
        </p>
        <script type="text/javascript" src="../SkinSupport/MadCapBodyEnd.js">
        </script>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom" style="display: none;"><a href="../../Default_CSH.htm#DFUG/Chapter5.htm" style="">Open topic with navigation</a>
        </p>
    </body>
</html>