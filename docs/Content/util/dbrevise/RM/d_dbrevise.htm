<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:tocPath="Utility Programs|Utility Function Descriptions" MadCap:InPreviewMode="false" MadCap:PreloadImages="false" MadCap:RuntimeFileType="Topic" MadCap:TargetType="WebHelp" lang="en-us" xml:lang="en-us" class="" MadCap:PathToHelpSystem="../../../../" MadCap:HelpSystemFileName="Default.xml" MadCap:SearchType="Stem">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>d_dbrevise</title>
        <link rel="icon" type="image/png" href="http://docs.raima.com/favicon.png" />
        <link href="../../../SkinSupport/MadCap.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/ParamStruct.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/FunctionArgs.css" rel="stylesheet" />
        <link href="../../../Resources/TableStyles/CoreErrCodes.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/raima.css" rel="stylesheet" />
        <script src="../../../SkinSupport/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop" style="display: none;"><a href="../../../../Default_CSH.htm#util/dbrevise/RM/d_dbrevise.htm" style="">Open topic with navigation</a>
        </p>
        <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="../../../dbUTIL.htm">Utility Programs</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="../../../RM/Chapter39.htm">Utility Function Descriptions</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">d_dbrevise</span>
        </div>
        <h3 class="newpage"><a name="kanchor424"></a>d_dbrevise</h3>
        <p>Database revision utility API.</p>
        <p class="Heading">Prototype</p><pre xml:space="preserve">int32_t <b>d_dbrevise</b>(
    const DBREVISE_PARAMS *<i>params</i>,
    DB_TASK               *<i>task</i>);
</pre><pre xml:space="preserve">int32_t <b>d_dbreviseW</b>(
    const DBREVISE_PARAMSW *<i>params</i>,
    DB_TASK                *<i>task</i>);</pre>
        <p class="Heading">Parameters</p>
        <table style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/FunctionArgs.css');margin-left: 0;margin-right: auto;" class="TableStyle-FunctionArgs" cellspacing="0">
            <col style="width: 140px;" class="Column-Column1" />
            <col style="width: 80px;" class="Column-Column3" />
            <col class="Column-Column2" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">params</td>
                    <td class="BodyB-Column3-Body1">(input)</td>
                    <td class="BodyA-Column2-Body1">A pointer to a DBREVISE_PARAMS structure.</td>
                </tr>
            </tbody>
        </table>
        <table style="width: 100%;mc-table-style: url('../../../Resources/TableStyles/FunctionArgs.css');margin-left: 0;margin-right: auto;caption-side: top;" class="TableStyle-FunctionArgs" cellspacing="0">
            <col style="width: 140px;" class="Column-Column1" />
            <col style="width: 80px;" class="Column-Column3" />
            <col class="Column-Column2" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">task</td>
                    <td class="BodyB-Column3-Body1">(input)</td>
                    <td class="BodyA-Column2-Body1">A pointer to a <code>DB_TASK</code> structure.</td>
                </tr>
            </tbody>
        </table>
        <p class="Heading">Description</p>
        <p>The d_dbrevise API is a callable function to migrate a database from one schema version to another schema version.  Please read the full db_revise Guide from more information on the revise process.</p>
        <table style="width: 100%;border-left-style: solid;border-left-width: 1px;border-left-color: #c0c0c0;border-right-style: solid;border-right-width: 1px;border-right-color: #c0c0c0;border-top-style: solid;border-top-width: 1px;border-top-color: #c0c0c0;border-bottom-style: solid;border-bottom-width: 1px;border-bottom-color: #c0c0c0;border-collapse: collapse;margin-left: 0;margin-right: auto;mc-table-style: url('../../../Resources/TableStyles/ParamStruct.css');caption-side: top;" class="TableStyle-ParamStruct" cellspacing="0">
            <caption>DBREVISE_PARAMS structure</caption>
            <col style="width: 112px;" class="Column-Column1" />
            <col style="width: 141px;" class="Column-Column2" />
            <col class="Column-Column3" />
            <thead>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1">Member</th>
                    <th class="HeadE-Column2-Header1">Type</th>
                    <th class="HeadD-Column3-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">quiet</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">DB_BOOLEAN</td>
                    <td class="BodyD-Column3-Body1">No output except for errors.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">verbose</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">DB_BOOLEAN</td>
                    <td class="BodyD-Column3-Body1">Show detailed output of the operations performed on the database</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Src_dbn</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int32_t</td>
                    <td class="BodyD-Column3-Body1">The database number for the source database</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Dest_dbn</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int32_t</td>
                    <td class="BodyD-Column3-Body1">The database number for the destination database</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Rdl_path</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">char[FILENMLEN]</td>
                    <td class="BodyD-Column3-Body1">The path of the RDL file, if you would like to use one</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Report_path</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">char[FILENMLEN]</td>
                    <td class="BodyD-Column3-Body1">The full path of the report output file. Required if <code>Report_f</code> is 1.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Script</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">const char *</td>
                    <td class="BodyD-Column3-Body1">A string that contains one or more RDL statements (terminated by semi-colons).  This eliminates the need for an RDL file when the RDL statements are short.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Intr_enable</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">Deprecated.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Comp_level</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">The compilation phase error level.  This should be 0 or 1.  Level 0 suppresses all warnings and non-fatal errors.  Level 1 allows all compilation phase errors to be printed. </td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Exec_level</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">The execution phase error level.  This should be 0 or 1.  Level 0 suppresses all warnings and non-fatal errors.  Level 1 allows all execution phase error messages to be printed.  </td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Abort_level</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">The abort level.  This should be is 0 or 1.  At Level 0, d_dbrevise will abort only because of fatal errors.  At Level 1 it will abort when a warning occurs during the execution phase.  </td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Table_f</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">Print the internal dbrevise table</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Report_f</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">Requests a report which will be written to source_db_name.rep.  The report will contain a copy of any RDL statements used and a summary of the differences between the source and destination schemas. Must specify <code>Report_path</code>.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Comp_f</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">The debug flag which will cause the API to perform the compilation phase only.  The destination database will not be affected.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Fast_f</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">int16_t</td>
                    <td class="BodyD-Column3-Body1">This is the fast revision option.  This will cause the revise process to speed up  by retaining deleted records in the destination database.  By retaining deleted records, revise can, in most cases, guarantee that the record addresses will remain the same between databases.</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyE-Column1-Body1">Fmode</td>
                    <td style="font-family: monospace;" class="BodyE-Column2-Body1">PSP_FILE_MODE</td>
                    <td class="BodyD-Column3-Body1">File format of script, RDL and report files:<br /><br />PSP_FILE_MODE_UNKNOWN (default)
 <br />PSP_FILE_MODE_UTF8<br />   PSP_FILE_MODE_UTF16
</td>
                </tr>
                <tr class="Body-Body1">
                    <td style="font-family: monospace;" class="BodyB-Column1-Body1">stdout_file</td>
                    <td style="font-family: monospace;" class="BodyB-Column2-Body1">const char *</td>
                    <td class="BodyA-Column3-Body1">This specifies the name of the file to which output data will be written. If set to PSP_STDOUT, stdout is used. If set to NULL or to an empty string, no output will be generated.</td>
                </tr>
            </tbody>
        </table>
        <p class="Heading">Currency Changes</p>
        <p>Currency is invalidated by using this API.</p>
        <p class="Heading">Locking Requirements</p>
        <p>This utility requires exclusive access to the database, so open both source and destination databases in "x" mode.</p>
        <p class="Heading">Required Headers</p><pre xml:space="preserve">#include "dutilproto.h"</pre>
        <p class="Heading">Libraries</p>
        <table style="width: 100%; margin-left: 0; margin-right: auto;">
            <col style="width: 200px;">
            </col>
            <col>
            </col>
            <thead>
                <tr>
                    <th>Library Name</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>rdmutil<span class="MyVariablesLibraryVersion">11</span></code>
                    </td>
                    <td><span class="MyVariablesProductShortName">RDM</span> Utility Library</td>
                </tr>
            </tbody>
        </table>
        <p>See <a href="../../../GS/distrib.htm#Library">Library Naming Conventions</a> section for full library name and a list of library dependencies.</p>
        <p class="Heading">Return Codes</p>
        <table class="TableStyle-CoreErrCodes" cellspacing="0" style="mc-table-style: url('../../../Resources/TableStyles/CoreErrCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <thead>
                <tr class="Head-Header1">
                    <th class="HeadE-Column1-Header1">Value</th>
                    <th class="HeadE-Column2-Header1">Name</th>
                    <th class="HeadD-Column3-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">0</td>
                    <td class="BodyB-Column2-Body1">S_OKAY</td>
                    <td class="BodyA-Column3-Body1">normal return, okay</td>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-CoreErrCodes" cellspacing="0" style="mc-table-style: url('../../../Resources/TableStyles/CoreErrCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">-1</td>
                    <td class="BodyB-Column2-Body1">S_DBOPEN</td>
                    <td class="BodyA-Column3-Body1">database not opened</td>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-CoreErrCodes" cellspacing="0" style="mc-table-style: url('../../../Resources/TableStyles/CoreErrCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">-24</td>
                    <td class="BodyB-Column2-Body1">S_NOTLOCKED</td>
                    <td class="BodyA-Column3-Body1">attempt to access unlocked set/record</td>
                </tr>
            </tbody>
        </table>
        <table class="TableStyle-CoreErrCodes" cellspacing="0" style="mc-table-style: url('../../../Resources/TableStyles/CoreErrCodes.css');">
            <col class="Column-Column1" />
            <col class="Column-Column2" />
            <col class="Column-Column3" />
            <tbody>
                <tr class="Body-Body1">
                    <td class="BodyB-Column1-Body1">-939</td>
                    <td class="BodyB-Column2-Body1">S_READONLY</td>
                    <td class="BodyA-Column3-Body1">unable to update file due to READONLY option</td>
                </tr>
            </tbody>
        </table>
        <p class="Heading">See Also</p>
        <p><a href="../Chapter1.htm">dbrev utility</a>
        </p>
        <p><a href="../../../GS/Migration.htm#Database">Migration Issues (Database Compatibility)</a>
        </p>
        <p class="Heading">Example</p><pre>/* RDM Database Revision Utility API Example ******************************
*/
int32_t MAIN(int32_t argc, const char *const *argv)
{
    const char       *srcdbname  = "timsold";
    const char       *destdbname = "tims";
    int32_t           status     = S_OKAY;
    DB_TASK          *task;
    DBREVISE_PARAMS   params;

    memset(&amp;params, 0, sizeof(DBREVISE_PARAMS));

    params.Comp_level = 1;
    params.Exec_level = 1;
    params.verbose  = 0;
    params.stdout_file = PSP_STDOUT;

    if ((status = d_opentask(&amp;task)) == S_OKAY)
    {
        if ((status = d_open(srcdbname, "x", task)) == S_OKAY)
        {
            params.Src_dbn = d_dbnum(srcdbname, task);      
            if ((status = d_iopen(destdbname, task)) == S_OKAY)
            {
                params.Dest_dbn = d_dbnum(destdbname, task);      
                status = d_dbrevise(&amp;params, task);
            }
            d_close(task);
        }
        d_closetask(task);
    }

    return(0);
}
</pre>
        <hr MadCap:conditions="Default.ScreenOnly" width="100%" size="0" align="center" />
        <p MadCap:conditions="Default.ScreenOnly" style="font-size: 8pt;"><span class="MyVariablesCopyright">Copyright © 2012, Raima Inc. All rights reserved.</span>
        </p>
        <script type="text/javascript" src="../../../SkinSupport/MadCapBodyEnd.js">
        </script>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkBottom" style="display: none;"><a href="../../../../Default_CSH.htm#util/dbrevise/RM/d_dbrevise.htm" style="">Open topic with navigation</a>
        </p>
    </body>
</html>